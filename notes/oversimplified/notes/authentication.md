# AUTHENTICATION

Using bcrypt for password hashing and JWT (JSON Web Tokens) for authentication in an Express.js application generated by express-generator is a common requirement. 

### Basic guide on how to integrate bcrypt and JWT into an Express.js application created with express-generator:

1. **Generate a new Express.js application**: If you haven't already, generate a new Express.js application using express-generator by running the following command:

   ```bash
   npx express-generator myapp
   ```

2. **Navigate into your project directory**: Once the application is generated, navigate into the project directory:

   ```bash
   cd myapp
   ```

3. **Install necessary packages**: Install the required packages such as `bcrypt`, `jsonwebtoken`, and `express-jwt`:

   ```
   npm install jsonwebtoken
   ```
   ```bash
   npm install bcrypt  express-jwt
   ```

4. **Create a User Model**: Create a `User` model to handle user data and authentication. For example, in the `models/user.js` file:

   ```javascript
   const mongoose = require('mongoose');
   const bcrypt = require('bcrypt');

   const userSchema = new mongoose.Schema({
     username: { type: String, unique: true, required: true },
     password: { type: String, required: true }
   });

   // Hash the password before saving it to the database
   userSchema.pre('save', async function(next) {
     const user = this;
     if (!user.isModified('password')) return next();

     const salt = await bcrypt.genSalt(10);
     const hash = await bcrypt.hash(user.password, salt);
     user.password = hash;
     next();
   });

   userSchema.methods.comparePassword = async function(candidatePassword) {
     return await bcrypt.compare(candidatePassword, this.password);
   };

   module.exports = mongoose.model('User', userSchema);
   ```

5. **Create JWT Token**: Implement a function to generate JWT tokens. For example, in a file named `utils/auth.js`:

   ```javascript
   const jwt = require('jsonwebtoken');

   function generateToken(user) {
     return jwt.sign({ id: user.id }, 'secret', { expiresIn: '1h' });
   }

   module.exports = { generateToken };
   ```

6. **Create Authentication Middleware**: Create a middleware to authenticate JWT tokens. For example, in a file named `middlewares/authenticate.js`:

   ```javascript
   const jwt = require('express-jwt');

   const authenticate = jwt({ secret: 'secret', algorithms: ['HS256'] });

   module.exports = authenticate;
   ```

7. **Integrate Authentication Routes**: Implement routes for user authentication (register, login, etc.) using the `User` model, bcrypt for password hashing, and JWT for token generation. For example:

   ```javascript
   const express = require('express');
   const router = express.Router();
   const User = require('../models/user');
   const { generateToken } = require('../utils/auth');

   router.post('/register', async (req, res) => {
     try {
       const { username, password } = req.body;
       const user = new User({ username, password });
       await user.save();
       const token = generateToken(user);
       res.json({ token });
     } catch (error) {
       res.status(400).json({ message: error.message });
     }
   });

   router.post('/login', async (req, res) => {
     try {
       const { username, password } = req.body;
       const user = await User.findOne({ username });
       if (!user) throw new Error('User not found');
       const isMatch = await user.comparePassword(password);
       if (!isMatch) throw new Error('Invalid credentials');
       const token = generateToken(user);
       res.json({ token });
     } catch (error) {
       res.status(401).json({ message: error.message });
     }
   });

   module.exports = router;
   ```

8. **Mount Authentication Routes**: Mount the authentication routes in your Express app's main file (e.g., `app.js`):

   ```javascript
   const express = require('express');
   const authRoutes = require('./routes/authenticate');

   const app = express();

   app.use(express.json());

   app.use('/auth', authRoutes);

   // other routes and middleware

   module.exports = app;
   ```

